<div class="body container-fluid">


    <div class="row mt-2">
        <div class="col-md-3 card p-2">

            <div>
                <div class="w-100">
                    <mat-form-field appearance="outline" class="w-100 matSmall">
                        <mat-label>Type</mat-label>

                        <mat-select [(ngModel)]="catType" name="catType">
                            <mat-option value="SubCat">Sub Categorywise</mat-option>
                            <mat-option value="Brand">Brandwise</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <div class="w-100 " *ngIf="catType == 'SubCat'">
                    <mat-form-field appearance="outline" class="w-100 matSmall">
                        <mat-label>Sub Category</mat-label>

                        <mat-select [(ngModel)]="SubCategoryID" #subCategory name="pSubCategory">
                            <mat-option><ngx-mat-select-search #subcatsearch [placeholderLabel]="'Search...'"
                                    [noEntriesFoundLabel]="'Not found'"></ngx-mat-select-search></mat-option>
                            <mat-option *ngFor="let item of SubCategoriesList| filter:subcatsearch.value "
                                [value]="item.subCategoryID">{{item.subCategoryTitle}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <div class="w-100" *ngIf="catType == 'Brand'">
                    <mat-form-field appearance="outline" class="w-100 matSmall">
                        <mat-label>Brand</mat-label>
                        <mat-select [(ngModel)]="BrandID" #brand>
                            <mat-option><ngx-mat-select-search #brandSearch [placeholderLabel]="'Search...'"
                                    [noEntriesFoundLabel]="'Not found'"></ngx-mat-select-search></mat-option>
                            <mat-option *ngFor="let item of BrandList | filter:brandSearch.value"
                                [value]="item.brandID">{{item.brandTitle}}</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

            </div>

            <div class="d-flex justify-content-around">
                <button mat-raised-button  class="col-md-4 bg-success text-white"
                    style="height: 45px;" (click)="filterProduct()">Get Products</button>
                <button mat-raised-button  class="col-md-4 bg-success text-white"
                    style="height: 45px;" (click)="openSavedBillModal()">Purchases</button>
            </div>


            <div class="d-flex flex-column">
                <mat-checkbox [(ngModel)]="showCompany">Show Company</mat-checkbox>
                <mat-checkbox [(ngModel)]="showPrice">Show Price</mat-checkbox>
                <mat-checkbox [(ngModel)]="showTitle">Show Title</mat-checkbox>
                <mat-checkbox [(ngModel)]="showBarcode">Show Barcode</mat-checkbox>
            </div>



        </div>
        <div class="col-md-9 card p-2 ">

            <div class="d-flex gap-2 justify-content-end">
                <button class="btnsave" (click)="startPrinting()">Print Barcode</button>

                <button class="btnsave" (click)="printTags()">Print Tags</button>
            </div>


            <div class="row">
                <div class="col-lg-10 pe-1  d-flex flex-column ">
                    <mat-label class="text-primary">Search Barcode / Product</mat-label>
                    <input type="text" #pbarcode [(ngModel)]="PBarcode"
                        (keydown)="changeFocus($event,'.prodRow');searchByCode($event)" id="searchProduct"
                        class="p-1 ps-2 mb-2 searchProduct" placeholder="Alt + b" autofocus autocomplete="off"
                        accesskey="b">

                    <div class="  d-flex flex-column SearchConatiner cursorPointer "
                        *ngIf="PBarcode != '' && PBarcode != undefined">
                        <mat-card class="card "
                            *ngFor="let item of productList| filter:PBarcode | slice:0:25 index as index">
                            <button style="height: 40px; background: none;border: none;text-align: left;"
                                class="prodRow{{index}} prodBtn justify-content-between d-flex"
                                (click)="onProductSelected(item);"
                                (keydown)=" handleProdFocus(item,$event,'.prodRow','.searchProduct',productList)">
                                <p>{{item.productTitle}}</p>
                                <p><strong>({{item.barcode}})</strong></p>
                            </button>
                        </mat-card>
                    </div>

                </div>
                <div class="col-md-2 text-start pt-3 mt-1">
                    <button class="btnload w-100 " style="height: 40px;" (click)="ngOnInit()">Load</button>

                </div>
            </div>


            <div style="height: 65vh;overflow-y: auto;">
                <table class="table">
                    <thead>
                        <tr>
                            <th><mat-checkbox (change)="onCheckedAll($event)"></mat-checkbox>S#</th>
                            <th>Product Title</th>
                            <th>Barcode</th>
                            <th>Qty</th>
                            <th>Cost</th>
                            <th>Sale</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of tableDataList index as index">
                            <td><mat-checkbox [(ngModel)]="item.isChecked"></mat-checkbox>{{index +1}}</td>
                            <td>{{item.flavourTitle ? item.flavourTitle : item.productTitle}}</td>
                            <td>{{item.barcode2 ? item.barcode2 : item.barcode}}</td>
                            <td class="cursorPointer" (click)="editQty(item)">{{item.quantity | number:'1.0-0'}}</td>
                            <td>{{item.costPrice | number:'1.0-0'}}</td>
                            <td>{{item.salePrice | number:'1.0-0'}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>








        </div>
    </div>


</div>



<div class="hide">
    <div class="d-flex  justify-content-center ">
        <div id="PrintDiv" class="border">


            <div class="cmpName" *ngIf="showCompany">{{companyName}}</div>
            <div class="bcodet" *ngIf="showTitle">{{curProductRow.flavourTitle ? curProductRow.flavourTitle :
                curProductRow.productTitle|slice:0:24}}</div>
            <!-- <span class="bcodet">{{item.productTitle
                |slice:0:24}}...</span> -->
            <ngx-barcode6 class="barcode" [bc-format]="'CODE128'" [bc-height]="40" [bc-background]="'none'"
                [bc-width]="getBarcodeWidth(curProductRow?.barcode2 ? curProductRow?.barcode2 : curProductRow?.barcode || '')"
                [bc-value]="curProductRow?.barcode2 ? curProductRow?.barcode2 : curProductRow?.barcode"
                [bc-font-size]="10" [bc-text-margin]="-2" [bc-display-value]="true" [bc-font-options]="'bold'"
                [bc-text-position]="'bottom'" [bc-text-align]="'right'"></ngx-barcode6>
            <!-- <span class="barcodeText">{{item.barcode}}</span> -->
            <!-- <div class="font-barcode" >*{{item.barcode}}*</div>
                        <div class="bcodeC">{{item.barcode}}</div> -->
            <div [ngClass]="showPrice ? 'bcodep' : '' " class=" text-end" style="margin-top: -10px !important;"
                *ngIf="showPrice">Rs.{{curProductRow?.salePrice|number:'1.0-0'}}</div>
        </div>


    </div>
</div>





<div class="hide">
    <div id="PrintTags">
        <div class="d-flex flex-wrap gap-2 justify-content-between p-1">
            <div *ngFor="let item of tagList" style="width: 49%;">

                <div class="d-flex border border-dark">
                    <div class="col-md-6 d-flex flex-column justify-content-center" *ngIf="showCompany">
                        <img src="{{companyLogo}}" style="color: black;" alt="" srcset="" [height]="logoHeight"
                            [width]="logoWidth">
                        <div class="text-center fw-bold">
                            {{printDate|date:'dd-MM-yyyy'}}
                        </div>
                    </div>
                    <div class=" p-1 " [ngClass]="showCompany ? 'col-md-6' : 'col-md-12'">
                        <!-- <h2 class="cmpName text-center" *ngIf="showCompany">{{companyName}}</h2> -->
                        <div *ngIf="showBarcode" class="fw-bold text-center" style="font-size: 20px;">
                            {{item.barcode2 ?
                            item.barcode2 : item.barcode}}</div>
                        <div style="font-size: 15px;line-height: 15px;" class="fw-bold text-center" *ngIf="showTitle">
                            {{item.flavourTitle ? item.flavourTitle : item.productTitle}}
                        </div>



                        <div class=" text-center fw-bold" [ngClass]="item.discInR > 0 ? 'original-price' : ''"
                            style="font-size: 20px;" *ngIf="showPrice">
                            Rs.{{ item.salePrice |number:'1.0-0'}}</div>
                        <div class=" text-center fw-bold discounted-price " *ngIf="showPrice && item.discInR > 0 "
                            style="font-size: 20px;">
                            Rs.{{ item.salePrice - item.discInR |number:'1.0-0'}}</div>


                    </div>
                </div>
            </div>

        </div>

    </div>
</div>


<div class="modal" id="savedBillModal" tabindex="-1" data-bs-backdrop="true" aria-labelledby="holdModalLabel">
    <div class="modal-dialog modal-dialog-scrollable modal-xl">
        <div class="modal-content">

            <div class="modal-header">
                <h2 class="modal-title" id="holdModalLabel">Bill Details</h2>
                <button type="button" class="btn-close" id="clsMdl" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="w-100">

                    <div class="d-flex justify-content-between">
                        <mat-form-field class="col-lg-4 matSmall" appearance="outline">
                            <mat-label>Date</mat-label>
                            <input matInput type="text" readonly="true" [(ngModel)]="SearchDate"
                                [matDatepicker]="hbDate">
                            <mat-datepicker-toggle matSuffix [for]="hbDate"></mat-datepicker-toggle>
                            <mat-datepicker #hbDate></mat-datepicker>
                        </mat-form-field>



                        <button mat-raised-button *ngIf="crudList.r" class="col-lg-4 bg-success text-white"
                            style="height: 45px;" (click)="findHoldBills('p')">Get Bill</button>

                        <mat-form-field class="col-lg-3 matSmall" appearance="outline">
                            <mat-label>Search.......</mat-label>
                            <input matInput #holdSearch type="text" class="col-lg-4">
                        </mat-form-field>

                    </div>


                    <mat-radio-group [(ngModel)]="searchBillType" class="mt-2">
                        <mat-radio-button value="all">All</mat-radio-button>
                        <mat-radio-button value="Date">Datewise</mat-radio-button>
                    </mat-radio-group>

                    <div >
                        <table class="table">
                            <thead>
                                <tr>
                                    <th> S#</th>
                                    <th>Inv No.</th>
                                    <th>Date</th>
                                    <th>Party</th>
                                    <th>Location</th>
                                    <th>Amount</th>
                                    <th>User</th>
                                    <th>Action</th>
                                </tr>

                            </thead>
                            <tbody>
                                <tr *ngFor="let item of invoiceList | filter:holdSearch.value index as index">
                                    <td> {{index+1}}</td>
                                    <td>{{item.invBillNo}}</td>
                                    <td>{{item.invDate | date:'dd-MM-yyyy'}}</td>
                                    <td>{{item.partyName}}</td>
                                    <td>{{item.locationTitle}}</td>
                                    <td class="text-end">{{(item.billTotal + item.overHeadAmount) | number:'1.0-0'}}
                                    </td>
                                    <td>{{item.entryUser}}</td>
                                    <td><mat-icon class="cursorPointer" (click)="selectBill(item)">edit</mat-icon>
                                    </td>



                                </tr>
                            </tbody>
                        </table>

                    </div>



                </div>




            </div>

        </div>
    </div>
</div>